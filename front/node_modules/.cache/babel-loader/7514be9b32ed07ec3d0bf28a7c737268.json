{"ast":null,"code":"import _regeneratorRuntime from \"/mnt/d/20160745/github/gadgetProj/front/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/mnt/d/20160745/github/gadgetProj/front/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/mnt/d/20160745/github/gadgetProj/front/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/mnt/d/20160745/github/gadgetProj/front/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/mnt/d/20160745/github/gadgetProj/front/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/mnt/d/20160745/github/gadgetProj/front/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/mnt/d/20160745/github/gadgetProj/front/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/mnt/d/20160745/github/gadgetProj/front/src/pages/Workspace.js\";\nimport React, { Component } from 'react';\nimport { SketchField, Tools } from 'components/react-sketch';\nimport styles from './Workspace.scss';\nimport classNames from 'classnames';\nimport * as api from '../lib/api';\nvar cx = classNames.bind(styles);\n\nvar Workspace =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Workspace, _Component);\n\n  function Workspace(props) {\n    var _this;\n\n    _classCallCheck(this, Workspace);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Workspace).call(this, props));\n\n    _this.getImageSize =\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(dataUrl) {\n        var img;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return api.imageLoader(dataUrl);\n\n              case 3:\n                img = _context.sent;\n                console.log(\"Get image size start\");\n\n                _this.setState({\n                  width: img.width,\n                  height: img.height\n                });\n\n                console.log(\"Get image size complete\");\n                _context.next = 12;\n                break;\n\n              case 9:\n                _context.prev = 9;\n                _context.t0 = _context[\"catch\"](0);\n                console.log(_context.t0);\n\n              case 12:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[0, 9]]);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    _this.getImage =\n    /*#__PURE__*/\n    function () {\n      var _ref2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(image_route, org_id) {\n        var response, dataUrl;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.prev = 0;\n                _context2.next = 3;\n                return api.getImage(image_route, org_id);\n\n              case 3:\n                response = _context2.sent;\n                console.log(\"get image\"); //console.log(\"response: \",response);\n\n                dataUrl = \"data:image/png; base64, \".concat(response.data.photo); //console.log(dataUrl);\n\n                _this.getImageSize(dataUrl); //console.log(\"user_id : \", response.data.id);\n\n\n                _this.setState({\n                  user_id: response.data.id,\n                  download_URL: dataUrl,\n                  fixed_URL: dataUrl,\n                  zoom_factor: 1\n                });\n\n                _context2.next = 13;\n                break;\n\n              case 10:\n                _context2.prev = 10;\n                _context2.t0 = _context2[\"catch\"](0);\n                console.log(_context2.t0);\n\n              case 13:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[0, 10]]);\n      }));\n\n      return function (_x2, _x3) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    _this.postImage =\n    /*#__PURE__*/\n    function () {\n      var _ref3 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(user_id, org_id, upload_string, upload_route) {\n        var response, win;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.prev = 0;\n                _context3.next = 3;\n                return api.postImage(user_id, org_id, upload_string, upload_route);\n\n              case 3:\n                response = _context3.sent;\n                console.log(\"post image\"); //console.log(response);\n\n                win = window.open();\n                win.document.write('<iframe src=\"data:image/png;base64,' + upload_string + '\" frameborder=\"0\" style=\"border:0; top:0px; left:0px; bottom:0px; right:0px; width:100%; height:100%;\" allowfullscreen></iframe>');\n                _context3.next = 12;\n                break;\n\n              case 9:\n                _context3.prev = 9;\n                _context3.t0 = _context3[\"catch\"](0);\n                console.log(_context3.t0);\n\n              case 12:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this, [[0, 9]]);\n      }));\n\n      return function (_x4, _x5, _x6, _x7) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    _this.handleZoom =\n    /*#__PURE__*/\n    function () {\n      var _ref4 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4(zoomFactor) {\n        var download_URL, fixed_URL;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                download_URL = _this.state.download_URL;\n                _context4.next = 3;\n                return api.imageFixer(download_URL, zoomFactor);\n\n              case 3:\n                fixed_URL = _context4.sent;\n\n                _this.setState({\n                  zoom_factor: zoomFactor,\n                  fixed_URL: fixed_URL\n                });\n\n              case 5:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      return function (_x8) {\n        return _ref4.apply(this, arguments);\n      };\n    }();\n\n    _this.handleReduce_2 = function () {\n      _this.handleZoom(0.5);\n    };\n\n    _this.handleZoom_1 = function () {\n      _this.handleZoom(1);\n    };\n\n    _this.handleZoom_2 = function () {\n      _this.handleZoom(2);\n    };\n\n    _this.handleZoom_4 = function () {\n      _this.handleZoom(4);\n    };\n\n    _this.handleReset = function () {\n      _this._sketch.clear();\n\n      _this.handleZoom_1();\n    };\n\n    _this.handleUpload =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee5() {\n      var upload_url, string_list, upload_string, _this$state, user_id, org_id, upload_path;\n\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return _this.setState({\n                zoom_factor: 1,\n                fixed_URL: _this.state.download_URL\n              });\n\n            case 2:\n              upload_url = _this._sketch.toDataURL(\"image/png\");\n              string_list = upload_url.split(',');\n              upload_string = string_list[1]; //console.log(\"upload string: \",upload_string);\n\n              _this$state = _this.state, user_id = _this$state.user_id, org_id = _this$state.org_id, upload_path = _this$state.upload_path;\n\n              _this.postImage(user_id, org_id, upload_string, upload_path);\n\n            case 7:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5, this);\n    }));\n\n    _this.componentDidUpdate = function () {\n      console.log(\"componentDidUpdate\");\n\n      _this._sketch.setBackgroundFromDataUrl(_this.state.fixed_URL);\n    };\n\n    console.log(\"constructor\");\n    _this.state = {\n      loading: false,\n      download_URL: null,\n      fixed_URL: null,\n      zoom_factor: 1,\n      width: 905,\n      height: 14,\n      user_id: 1,\n      org_id: 15000,\n      upload_path: 'admin/request_checking'\n    };\n    return _this;\n  }\n\n  _createClass(Workspace, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      console.log(\"componentDidMount\");\n      this.getImage('admin/show_one_image', this.state.org_id);\n    }\n  }, {\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate() {\n      console.log(\"shouldComponentUpdate\");\n      return true; //return this.state !== this.prevState;\n    }\n    /*\r\n    componentWillUpdate() {\r\n        \r\n    }\r\n      */\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      console.log(\"render\");\n      return React.createElement(\"div\", {\n        className: \"entire brown lighten-5\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 169\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"instructions\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 170\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"sketch-box\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174\n        },\n        __self: this\n      }, React.createElement(SketchField, {\n        className: \"sketch-field\",\n        ref: function ref(c) {\n          return _this2._sketch = c;\n        },\n        width: this.state.width * this.state.zoom_factor,\n        height: this.state.height * this.state.zoom_factor,\n        tool: Tools.Pencil,\n        lineColor: \"red\",\n        lineWidth: 3,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 175\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: cx(\"right-buttons\"),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        className: cx(\"reset-button\", \"btn\", \"blue\"),\n        onClick: this.handleReset,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 185\n        },\n        __self: this\n      }, \"Reset\"), React.createElement(\"button\", {\n        className: cx(\"submit-button\", \"btn\", \"waves-effect\", \"waves-light\", \"blue\"),\n        onClick: this.handleUpload,\n        type: \"submit\",\n        name: \"action\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186\n        },\n        __self: this\n      }, \"Submit\", React.createElement(\"i\", {\n        className: cx(\"material-icons\", \"right\"),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187\n        },\n        __self: this\n      }, \"send\"))), React.createElement(\"div\", {\n        className: \"zoom-buttons\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        className: cx(\"x05-button\", \"waves-effect\", \"waves-light\", \"btn\", \"blue\", \"lighten-2\"),\n        onClick: this.handleReduce_2,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192\n        },\n        __self: this\n      }, \"X0.5\"), React.createElement(\"button\", {\n        className: cx(\"x1-button\", \"waves-effect\", \"waves-light\", \"btn\", \"blue\", \"lighten-2\"),\n        onClick: this.handleZoom_1,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193\n        },\n        __self: this\n      }, \"X1\"), React.createElement(\"button\", {\n        className: cx(\"x2-button\", \"waves-effect\", \"waves-light\", \"btn\", \"blue\", \"lighten-2\"),\n        onClick: this.handleZoom_2,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 194\n        },\n        __self: this\n      }, \"X2\"), React.createElement(\"button\", {\n        className: cx(\"x4-button\", \"waves-effect\", \"waves-light\", \"btn\", \"blue\", \"lighten-2\"),\n        onClick: this.handleZoom_4,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195\n        },\n        __self: this\n      }, \"X4\")));\n    }\n  }]);\n\n  return Workspace;\n}(Component);\n\nexport default Workspace;","map":{"version":3,"sources":["/mnt/d/20160745/github/gadgetProj/front/src/pages/Workspace.js"],"names":["React","Component","SketchField","Tools","styles","classNames","api","cx","bind","Workspace","props","getImageSize","dataUrl","imageLoader","img","console","log","setState","width","height","getImage","image_route","org_id","response","data","photo","user_id","id","download_URL","fixed_URL","zoom_factor","postImage","upload_string","upload_route","win","window","open","document","write","handleZoom","zoomFactor","state","imageFixer","handleReduce_2","handleZoom_1","handleZoom_2","handleZoom_4","handleReset","_sketch","clear","handleUpload","upload_url","toDataURL","string_list","split","upload_path","componentDidUpdate","setBackgroundFromDataUrl","loading","c","Pencil"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport {SketchField, Tools} from 'components/react-sketch';\r\nimport styles from './Workspace.scss';\r\nimport classNames from 'classnames';\r\nimport * as api from '../lib/api';\r\n\r\nconst cx = classNames.bind(styles);\r\n\r\nclass Workspace extends Component {\r\n    constructor(props){\r\n        super(props);\r\n        console.log(\"constructor\");\r\n        this.state = {\r\n            loading: false,\r\n            download_URL: null,\r\n            \r\n            fixed_URL: null,\r\n    \r\n            zoom_factor: 1,\r\n    \r\n            width: 905,\r\n            height: 14,\r\n            \r\n            user_id: 1,\r\n            org_id: 15000,\r\n                \r\n            upload_path: 'admin/request_checking',\r\n    \r\n        };\r\n    }\r\n    \r\n\r\n    getImageSize = async (dataUrl) => {\r\n        try {\r\n            const img = await api.imageLoader(dataUrl);\r\n\r\n            console.log(\"Get image size start\")\r\n            this.setState({\r\n                width: img.width,\r\n                height: img.height\r\n            })\r\n            console.log(\"Get image size complete\");\r\n        }\r\n        catch (e) {\r\n            console.log(e);\r\n        }\r\n    }\r\n\r\n    getImage = async (image_route, org_id) => {\r\n        try {\r\n            const response = await api.getImage(image_route, org_id);\r\n            console.log(\"get image\");\r\n            //console.log(\"response: \",response);\r\n            \r\n            const dataUrl = `data:image/png; base64, ${response.data.photo}`;\r\n            //console.log(dataUrl);\r\n\r\n            this.getImageSize(dataUrl);\r\n            //console.log(\"user_id : \", response.data.id);\r\n            this.setState({\r\n                user_id: response.data.id,\r\n                download_URL: dataUrl,\r\n                fixed_URL: dataUrl,\r\n                zoom_factor: 1\r\n                \r\n            })\r\n\r\n        }\r\n\r\n        catch(e) {\r\n            console.log(e);\r\n        }\r\n    \r\n    }\r\n\r\n    postImage = async (user_id, org_id, upload_string, upload_route) => {\r\n        try {\r\n            const response = await api.postImage(user_id, org_id, upload_string, upload_route);\r\n            console.log(\"post image\");\r\n            //console.log(response);\r\n\r\n            let win = window.open();\r\n            win.document.write('<iframe src=\"data:image/png;base64,' + upload_string + '\" frameborder=\"0\" style=\"border:0; top:0px; left:0px; bottom:0px; right:0px; width:100%; height:100%;\" allowfullscreen></iframe>')\r\n                                 \r\n        }\r\n\r\n        catch(e) {\r\n          console.log(e);\r\n        }\r\n\r\n    }\r\n\r\n    handleZoom = async (zoomFactor) => {\r\n        const {download_URL} = this.state;\r\n        const fixed_URL = await api.imageFixer(download_URL, zoomFactor);\r\n        \r\n        this.setState({\r\n            zoom_factor: zoomFactor,\r\n            fixed_URL: fixed_URL\r\n        });\r\n        \r\n    }\r\n\r\n    handleReduce_2 = () => {\r\n        this.handleZoom(0.5);\r\n    }\r\n    handleZoom_1 = () => {\r\n        this.handleZoom(1);\r\n    }\r\n    handleZoom_2 = () => {\r\n        this.handleZoom(2);\r\n    }\r\n    handleZoom_4 = () => {\r\n        this.handleZoom(4);\r\n    }\r\n    \r\n\r\n    \r\n    handleReset = () => {\r\n        this._sketch.clear();\r\n        this.handleZoom_1();\r\n\r\n    }\r\n\r\n    handleUpload = async () => {\r\n        await this.setState({\r\n            zoom_factor: 1,\r\n            fixed_URL: this.state.download_URL\r\n        })\r\n        \r\n        const upload_url = this._sketch.toDataURL(\"image/png\");\r\n\r\n        let string_list = upload_url.split(',');\r\n        let upload_string = string_list[1];\r\n        //console.log(\"upload string: \",upload_string);\r\n\r\n        const { user_id, org_id, upload_path } = this.state;\r\n        this.postImage(user_id, org_id, upload_string, upload_path);\r\n        \r\n    }\r\n\r\n    componentDidMount() {\r\n        console.log(\"componentDidMount\");\r\n        this.getImage('admin/show_one_image', this.state.org_id);\r\n        \r\n    }\r\n\r\n    \r\n    shouldComponentUpdate() {\r\n        console.log(\"shouldComponentUpdate\");\r\n        return true;\r\n        //return this.state !== this.prevState;\r\n    }\r\n    \r\n    /*\r\n    componentWillUpdate() {\r\n        \r\n    }\r\n\r\n    */\r\n    componentDidUpdate = () => {\r\n        console.log(\"componentDidUpdate\");\r\n        this._sketch.setBackgroundFromDataUrl(this.state.fixed_URL);\r\n    }\r\n\r\n    render () {\r\n        console.log(\"render\");\r\n        return (\r\n            <div className=\"entire brown lighten-5\">\r\n                <div className = \"instructions\">\r\n\r\n                </div>\r\n\r\n                <div className=\"sketch-box\">\r\n                    <SketchField className = \"sketch-field\"\r\n                                 ref={c => (this._sketch = c)}\r\n                                 width={this.state.width * this.state.zoom_factor}\r\n                                 height={this.state.height * this.state.zoom_factor} \r\n                                 tool={Tools.Pencil} \r\n                                 lineColor='red'\r\n                                 lineWidth={3}/>\r\n                </div>\r\n                \r\n                <div className = {cx(\"right-buttons\")}>\r\n                    <button className={cx(\"reset-button\", \"btn\", \"blue\")} onClick = {this.handleReset}>Reset</button>\r\n                    <button className={cx(\"submit-button\", \"btn\", \"waves-effect\", \"waves-light\", \"blue\")} onClick = {this.handleUpload} type=\"submit\" name=\"action\">\r\n                        Submit<i className={cx(\"material-icons\", \"right\")}>send</i>\r\n                    </button>\r\n                </div>\r\n\r\n                <div className = \"zoom-buttons\">\r\n                    <button className={cx(\"x05-button\", \"waves-effect\", \"waves-light\", \"btn\", \"blue\", \"lighten-2\")} onClick = {this.handleReduce_2}>X0.5</button>\r\n                    <button className={cx(\"x1-button\", \"waves-effect\", \"waves-light\", \"btn\", \"blue\", \"lighten-2\")} onClick = {this.handleZoom_1}>X1</button>\r\n                    <button className={cx(\"x2-button\", \"waves-effect\", \"waves-light\", \"btn\", \"blue\", \"lighten-2\")} onClick = {this.handleZoom_2}>X2</button>\r\n                    <button className={cx(\"x4-button\", \"waves-effect\", \"waves-light\", \"btn\", \"blue\", \"lighten-2\")} onClick = {this.handleZoom_4}>X4</button>\r\n                </div>\r\n                \r\n                \r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default Workspace;\r\n"]},"metadata":{},"sourceType":"module"}